<% if can? :create, User %>
	<div class="page-header">
		<h1>Listing proposals</h1>
	</div>
	<table class="table table-striped table-bordered table-condensed" id="proposals_table">
		<thead>
			<tr>
				<th width="300px">Title</th>
				<th>Assigned To</th>
				<th>Actions</th>
			</tr>
		</thead>
		<tbody>
		</tbody>
	</table>
	<script type="text/template" id="template_proposals_listitem">
	<td>
		<a href="{{baseURI}}/proposals/{{id}}">{{nsf_id}}</a> - 
		{{title}}
	</td>
	<td>{{users}}</td>
	<td>
		<a href="{{baseURI}}/proposals/{{id}}"><i class="icon-zoom-in"></i> Show</a><br />
		<% if can? :manage, :assignDivisionCan %>
			<a href="{{baseURI}}/proposals/{{id}}/edit"><i class="icon-pencil"></i> Edit</a><br />
			<a href="#" id="proposals_refresh_{{id}}"><i class="icon-refresh"></i> Refresh</a><br />
			<a href="#" id="proposals_remove_{{id}}"><i class="icon-remove"></i> Remove</a>			
		<% else %>
			<a href="#" id="proposals_unassign_{{id}}"><i class="icon-remove"></i> Remove</a>
		<% end %>
	</td>
	</script>
	<script type="text/Javascript">
	App.views = {
		'ListProposal': { el:$("#proposals_table"), division:'<%= current_user.division %>', useDataTables: true, allowEdit: <%= if can? :manage, :assignDivisionCan then true else false end %> }
	};
	</script>
<% else %>

<div class="page-header">
	<h1>Your assigned proposals</h1>
</div>
<p>Below is a list of the Proposals that were assigned to you. To review a proposal, please click either its Proposal ID or the "Review" link in the far right column.</p>
<table class="table table-striped table-bordered table-condensed" id="proposals_table">
	<thead>
		<tr>
			<th>Proposal</th>
			<th width="200px">Title</th>
			<th>Proposal Date</th>
			<th>Award</th>
			<th>Last Viewed</th>
			<th width="200px">Panel/s (Program Officer/s)</th>
			<th>Actions</th>
		</tr>
	</thead>
	<tbody>

<% @proposal.each do |proposal| %>
<%
details = ActiveSupport::JSON.decode(proposal.details)
panels = ActiveSupport::JSON.decode(proposal.panels)
%>			
			<tr>
				<td><%= link_to details['nsf_id'], proposal_path(proposal) %>
				<td><%= details['title'] %></td>
				<td><%= details['status']['date'] %></td>
				<td><%= details['status']['name']=="award"?"#{number_to_currency(details['awarded']['dollar']/1000,:precision=>0)}K": "(declined)"; %></td>
				<td>
					<%= time_ago_in_words proposal.associations[0].lastviewed unless proposal.associations[0].lastviewed.nil? %>
				</td>
				<td>
					<% panels.each do |panel| %>
						<%= "#{panel['nsf_id']} - #{panel['name']} (#{panel['officer']})" %><br />
					<% end %>
				</td>
				<td><%= link_to 'Review', proposal_path(proposal) %></td>
		<% end %>
	</tbody>
</table>
<% end %>			
